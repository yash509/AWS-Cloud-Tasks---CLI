Step 1: Find the latest Ubuntu AMI ID (example for Ubuntu 22.04 in a particular zone)

aws ec2 describe-images \
  --owners <account number> \
  --filters "Name=name,Values=ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*" \
  --query 'Images[*].[ImageId,Name]' \
  --region us-east-1 \
  --output table



Step 2: Create a Security Group with the Inbound Port allow:-

aws ec2 create-security-group \
  --group-name <sg-name> \
  --description "Security group for ALB allowing HTTP traffic"
  
aws ec2 authorize-security-group-ingress \
  --group-name devops-sg \
  --protocol tcp \
  --port 80 \
  --cidr 0.0.0.0/0
  
  
    
Step 3: Describe Subnets:-

aws ec2 describe-subnets \
  --query "Subnets[*].{SubnetId:SubnetId,SubnetName:Tags[?Key=='Name']|[0].Value,VpcId:VpcId,VpcName:(VpcId)}" \
  --output table



Step 4: Key Pair Create:-

aws ec2 create-key-pair \
  --key-name <key name> \
  --key-type rsa \
  --query 'KeyMaterial' \
  --output text > <key name>.pem



Step 5: Launch EC2 instance:-

aws ec2 run-instances \
  --image-id ami-0030e4319cbf4dbf2 \
  --count 1 \
  --instance-type t2.micro \
  --key-name <key name> \
  --security-group-ids <sg-id> \
  --subnet-id <subnet-id> \
  --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=<instance-name>}]' \
  --region us-east-1



Step 6: Create a Cloud Watch Alarm:- (Notify the devops-sns-topic if CPU utilization exceeds 90% for one 5 minute period.)

aws cloudwatch put-metric-alarm \
  --alarm-name "<alarm-name>" \
  --alarm-description "Alarm when CPU exceeds 90% for 5 minutes" \
  --metric-name CPUUtilization \
  --namespace AWS/EC2 \
  --statistic Average \
  --period 300 \
  --threshold 90 \
  --comparison-operator GreaterThanOrEqualToThreshold \
  --dimensions Name=InstanceId,Value=<instance ID> \
  --evaluation-periods 1 \
  --alarm-actions arn:aws:sns:us-east-1:123456789012:devops-sns-topic \
  --region us-east-1
